<html>
<!--
Popup widget

 customized the route color and line type
 customized the start and end symbols

 1st challenge: what API modules to load via require
 2nd challenge: oh, and you need to add a service to your API key
 3rd challenge: spend lots of time trying to set a read-only property
 4th challenge: no clue on syntax for setting properties that aren't read-only
 5th challenge: 3 conflicting answers for every question about ESRI products
 No 1 disappointment: unable to figure out how to set a default starting point
 No 2 disappointment: unable to set default transportation mode w javascript
-->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Lab 7: Popup Widget</title>
  <link rel="stylesheet" href="https://js.arcgis.com/4.21/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.21/"></script>
  <!-- padding stylesheet required for directions widget
  <link rel="stylesheet" type="text/css" href="../css/popup.css">--->
  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
    #instruction {
      z-index: 99;
      position: absolute;
      top: 15px;
      left: 50%;
      padding: 5px;
      margin-left: -175px;
      height: 60px;
      width: 355px;
      background: rgba(25, 25, 25, 0.8);
      color: white;
    }
  </style>

  <script>
      require(["esri/tasks/Locator",
              "esri/Map",
              "esri/views/MapView",
              "esri/Graphic",               // why is this
              "esri/layers/GraphicsLayer",  // soo complicated
              "esri/config"], (Locator,
                              Map,
                              MapView,
                              Graphic,
                              GraphicsLayer,
                              esriConfig) => {
        // An authorization string used to access the basemap, geocoding and routing services
        esriConfig.apiKey = "AAPK873ce78114b445028d46dd3b006206391X8iH6v9sB8ISYR-dc_uh5YzDmWsWBznuBZaYJNYvzcmQeLcfQIY28sVsyaXyEGw";

        // Create a locator task using the world geocoding service
        const locatorTask = new Locator({
          url: "https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"
        });

        const map = new Map({
          basemap: "dark-gray-vector"
        });

        const view = new MapView({
          zoom: 14,
          center: [-71.82, 42.25],  //center on Clark University
          container: "viewDiv",
          map: map
        });

        // jump through many hoops to add an orange dot to the map
        var graphicsLayer = new GraphicsLayer();
        map.add(graphicsLayer);
        var myApt = { type: "point", longitude: -71.820730, latitude: 42.251300};
        var orangeDot = {type: "simple-marker", color: [226, 119, 40],
            outline: {color: [255, 255, 255], width: 1}
          };
        var pointGraphic = new Graphic({geometry: myApt, symbol: orangeDot});
        graphicsLayer.add(pointGraphic);

        // Create Popup widget
        view.popup.autoOpenEnabled = false;
        view.on("click", (event) => {
          // Get the coordinates of the click on the view
          // around the decimals to 3 decimals
          const lat = Math.round(event.mapPoint.latitude * 1000) / 1000;
          const lon = Math.round(event.mapPoint.longitude * 1000) / 1000;

          view.popup.open({
            // Set the popup's title to the coordinates of the clicked location
            title: "You clicked location: [" + lon + ", " + lat + "]",
            location: event.mapPoint, // Set the location of the popup to the clicked location
            content: "lalalalala - I can't hear you"
          });
          console.log(event.mapPoint);
        });



      });
    </script>
  </head>
</head>

<body>
  <div id="viewDiv"></div>
  <div id="instruction" class="esri-widget">
    Click any location on the map to see how far it is from my apartment (orange dot)
  </div>
</body>

</html>
